openapi: 3.0.3
info:
  title: API Contract Management System
  version: "1.0.0"
  description: "API Contract Management System for managing clients, products, contracts, subscriptions, rate cards, and subscription tiers."
servers:
  - url: http://localhost:5000
    description: Local dev server
tags:
  - name: auth
    description: Authentication
  - name: users
    description: User management
  - name: clients
    description: Client management
  - name: products
    description: Product management
  - name: contracts
    description: Contract management
  - name: subscriptions
    description: Subscription management
  - name: rate_cards
    description: Rate Card management
  - name: subscription_tiers
    description: Subscription Tier management

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    idParam:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: UUID of the resource

  schemas:

    Envelope:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
        errors:
          type: object
        meta:
          type: object

    # User
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        full_name:
          type: string
        role:
          type: string
          enum: [employee, admin]
        is_archived:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateUser:
      type: object
      required: [email, password, full_name, role]
      properties:
        email:
          type: string
        password:
          type: string
        full_name:
          type: string
        role:
          type: string
          enum: [employee, admin]

    # Client
    Client:
      type: object
      properties:
        id:
          type: string
          format: uuid
        company_name:
          type: string
        email:
          type: string
        phone_number:
          type: string
        address:
          type: string
        is_archived:
          type: boolean

    CreateClient:
      type: object
      required: [company_name, email]
      properties:
        company_name: { type: string }
        email: { type: string }
        phone_number: { type: string }
        address: { type: string }

    # Product
    Product:
      type: object
      properties:
        id: { type: string, format: uuid }
        api_name: { type: string }
        description: { type: string }
        is_archived: { type: boolean }

    CreateProduct:
      type: object
      required: [api_name]
      properties:
        api_name: { type: string }
        description: { type: string }

    # Contract
    Contract:
      type: object
      properties:
        id: { type: string, format: uuid }
        client_id: { type: string, format: uuid }
        contract_name: { type: string }
        start_date: { type: string, format: date-time }
        end_date: { type: string, format: date-time }
        is_archived: { type: boolean }
        subscriptions:
          type: array
          items:
            $ref: '#/components/schemas/Subscription'

    CreateContract:
      type: object
      required: [client_id, contract_name, start_date, end_date]
      properties:
        client_id: { type: string, format: uuid }
        contract_name: { type: string }
        start_date: { type: string, format: date-time }
        end_date: { type: string, format: date-time }

    # Subscription
    Subscription:
      type: object
      properties:
        id: { type: string, format: uuid }
        contract_id: { type: string, format: uuid }
        product_id: { type: string, format: uuid }
        pricing_type:
          type: string
          enum: [Fixed, Variable]
        strategy:
          type: string
          enum: [Pick, Fill, Flat, Fixed]
        is_archived: { type: boolean }
        product:
          $ref: '#/components/schemas/Product'
        tiers:
          type: array
          items:
            $ref: '#/components/schemas/SubscriptionTier'

    CreateSubscription:
      type: object
      required: [contract_id, product_id, pricing_type, strategy]
      properties:
        contract_id: { type: string, format: uuid }
        product_id: { type: string, format: uuid }
        pricing_type:
          type: string
          enum: [Fixed, Variable]
        strategy:
          type: string
          enum: [Pick, Fill, Flat, Fixed]

    # RateCard
    RateCard:
      type: object
      properties:
        id: { type: string, format: uuid }
        subscription_id: { type: string, format: uuid }
        start_date: { type: string, format: date-time }
        end_date: { type: string, format: date-time }
        is_archived: { type: boolean }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
        tiers:
          type: array
          items:
            $ref: '#/components/schemas/SubscriptionTier'

    CreateRateCard:
      type: object
      required: [subscription_id, start_date, end_date]
      properties:
        subscription_id: { type: string, format: uuid }
        start_date: { type: string, format: date-time }
        end_date: { type: string, format: date-time }

    # SubscriptionTier
    SubscriptionTier:
      type: object
      properties:
        id: { type: string, format: uuid }
        rate_card_id: { type: string, format: uuid }
        min_calls: { type: integer }
        max_calls:
          type: integer
          description: -1 indicates infinite
        unit_price:
          type: number
          format: float
        is_archived: { type: boolean }

    CreateSubscriptionTier:
      type: object
      required: [rate_card_id, min_calls, max_calls, unit_price]
      properties:
        rate_card_id: { type: string, format: uuid }
        min_calls: { type: integer }
        max_calls: { type: integer }
        unit_price: { type: number, format: float }

    # Auth
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string }
        password: { type: string }

paths:
  /login:
    post:
      tags: [auth]
      summary: Login and receive JWT
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                loginSuccess:
                  value:
                    success: true
                    message: "Login successful"
                    data:
                      token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    errors: null
                    meta: null

  /protected:
    get:
      tags: [auth]
      summary: Access protected endpoint (requires JWT)
      description: Returns the current authenticated user; requires Authorization header with a valid JWT.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Protected endpoint accessed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                protectedSuccess:
                  value:
                    success: true
                    message: "Protected endpoint accessed successfully"
                    data:
                      user:
                        id: "11111111-1111-1111-1111-111111111111"
                        email: "admin@example.com"
                        full_name: "Admin User"
                        role: "admin"
                    errors: null
                    meta: null

  /users-first:
    post:
      tags: [users]
      summary: Create the first user (no auth)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUser'
      responses:
        '201':
          description: First user created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                createdFirstUser:
                  value:
                    success: true
                    message: "First user created successfully"
                    data:
                      user_id: "11111111-1111-1111-1111-111111111111"
                    errors: null
                    meta: null

  /users:
    get:
      tags: [users]
      summary: List users
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Users retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                usersList:
                  value:
                    success: true
                    message: "Users retrieved successfully"
                    data:
                      users:
                        - id: "11111111-1111-1111-1111-111111111111"
                          email: "admin@example.com"
                          full_name: "Admin User"
                          role: "admin"
                          is_archived: false
                        - id: "22222222-2222-2222-2222-222222222222"
                          email: "employee@example.com"
                          full_name: "Employee One"
                          role: "employee"
                          is_archived: false
                    errors: null
                    meta: null
    post:
      tags: [users]
      summary: Create a user (admin only)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUser'
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                userCreated:
                  value:
                    success: true
                    message: "User created successfully"
                    data:
                      user:
                        id: "33333333-3333-3333-3333-333333333333"
                        email: "new@example.com"
                        full_name: "New User"
                        role: "employee"
                        is_archived: false
                    errors: null
                    meta: null

  /users/{id}:
    get:
      tags: [users]
      summary: Get user by id
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      responses:
        '200':
          description: User returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                userGet:
                  value:
                    success: true
                    message: "User retrieved successfully"
                    data:
                      user:
                        id: "11111111-1111-1111-1111-111111111111"
                        email: "admin@example.com"
                        full_name: "Admin User"
                        role: "admin"
                        is_archived: false
                    errors: null
                    meta: null
    put:
      tags: [users]
      summary: Update user (replace)
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUser'
            examples:
              userPutExample:
                value:
                  email: "admin@updated.com"
                  password: "newstrongpassword"
                  full_name: "Admin User"
                  role: "admin"
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                userUpdated:
                  value:
                    success: true
                    message: "User updated successfully"
                    data:
                      user:
                        id: "11111111-1111-1111-1111-111111111111"
                        email: "admin@updated.com"
                        full_name: "Admin User"
                        role: "admin"
                        is_archived: false
                    errors: null
                    meta: null
    patch:
      tags: [users]
      summary: Update user (partial)
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      requestBody:
        content:
          application/json:
            schema:
              type: object
            examples:
              userPatchExample:
                value:
                  full_name: "Admin User Updated"
      responses:
        '200':
          description: User partially updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                userPatched:
                  value:
                    success: true
                    message: "User updated successfully"
                    data:
                      user:
                        id: "11111111-1111-1111-1111-111111111111"
                        full_name: "Admin User Updated"
                    errors: null
                    meta: null
    delete:
      tags: [users]
      summary: Archive (soft delete) a user
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      responses:
        '200':
          description: User archived
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                userArchived:
                  value:
                    success: true
                    message: "User archived successfully"
                    data:
                      user:
                        id: "11111111-1111-1111-1111-111111111111"
                        email: "admin@example.com"
                        is_archived: true
                    errors: null
                    meta: null

  /clients:
    get:
      tags: [clients]
      summary: List clients
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Clients retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                clientsList:
                  value:
                    success: true
                    message: "Clients retrieved successfully"
                    data:
                      clients:
                        - id: "aaaaaaa1-aaaa-aaaa-aaaa-aaaaaaaaaaa1"
                          company_name: "Acme Corp"
                          email: "contact@acme.example"
                          phone_number: "+1-555-0100"
                          address: "123 Main St"
                          is_archived: false
                    errors: null
                    meta: null
    post:
      tags: [clients]
      summary: Create a client
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateClient'
            examples:
              createClientExample:
                value:
                  company_name: "NewCo LLC"
                  email: "info@newco.example"
                  phone_number: "+1-555-0123"
                  address: "456 Market St"
      responses:
        '201':
          description: Client created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                clientCreated:
                  value:
                    success: true
                    message: "Client created successfully"
                    data:
                      client:
                        id: "aaaaaaa2-aaaa-aaaa-aaaa-aaaaaaaaaaa2"
                        company_name: "NewCo LLC"
                        email: "info@newco.example"
                        is_archived: false
                    errors: null
                    meta: null

  /clients/{id}:
    get:
      tags: [clients]
      summary: Get client by id
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      responses:
        '200':
          description: Client retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                clientGet:
                  value:
                    success: true
                    message: "Client retrieved successfully"
                    data:
                      client:
                        id: "aaaaaaa1-aaaa-aaaa-aaaa-aaaaaaaaaaa1"
                        company_name: "Acme Corp"
                        email: "contact@acme.example"
                        phone_number: "+1-555-0100"
                        address: "123 Main St"
                        is_archived: false
                    errors: null
                    meta: null
    put:
      tags: [clients]
      summary: Update client (replace)
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateClient'
            examples:
              clientPutExample:
                value:
                  company_name: "Acme Incorporated"
                  email: "contact@acme.example"
                  phone_number: "+1-555-0100"
                  address: "123 Main St"
      responses:
        '200':
          description: Client updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                clientUpdated:
                  value:
                    success: true
                    message: "Client updated successfully"
                    data:
                      client:
                        id: "aaaaaaa1-aaaa-aaaa-aaaa-aaaaaaaaaaa1"
                        company_name: "Acme Incorporated"
                        email: "contact@acme.example"
                        is_archived: false
                    errors: null
                    meta: null
    patch:
      tags: [clients]
      summary: Update client (partial)
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      requestBody:
        content:
          application/json:
            schema:
              type: object
            examples:
              clientPatchExample:
                value:
                  phone_number: "+1-555-0200"
      responses:
        '200':
          description: Client partially updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                clientPatched:
                  value:
                    success: true
                    message: "Client updated successfully"
                    data:
                      client:
                        id: "aaaaaaa1-aaaa-aaaa-aaaa-aaaaaaaaaaa1"
                        phone_number: "+1-555-0200"
                    errors: null
                    meta: null
    delete:
      tags: [clients]
      summary: Archive client
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      responses:
        '200':
          description: Client archived
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                clientArchived:
                  value:
                    success: true
                    message: "Client archived successfully"
                    data:
                      client:
                        id: "aaaaaaa1-aaaa-aaaa-aaaa-aaaaaaaaaaa1"
                        is_archived: true
                    errors: null
                    meta: null

  /clients/{id}/contracts:
    get:
      tags: [clients]
      summary: Get contracts for a client
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      responses:
        '200':
          description: Contracts retrieved for client
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                clientContracts:
                  value:
                    success: true
                    message: "Contracts retrieved successfully"
                    data:
                      contracts:
                        - id: "c1111111-1111-1111-1111-111111111111"
                          contract_name: "Acme Annual"
                          client_id: "aaaaaaa1-aaaa-aaaa-aaaa-aaaaaaaaaaa1"
                    errors: null
                    meta: null

  /products:
    get:
      tags: [products]
      summary: List products
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Products retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                productsList:
                  value:
                    success: true
                    message: "Products retrieved successfully"
                    data:
                      products:
                        - id: "p1111111-1111-1111-1111-111111111111"
                          api_name: "Billing API"
                          description: "Endpoints for billing and invoicing"
                          is_archived: false
                        - id: "p2222222-2222-2222-2222-222222222222"
                          api_name: "Reporting API"
                          description: "Usage and reporting endpoints"
                          is_archived: false
                    errors: null
                    meta: null
    post:
      tags: [products]
      summary: Create product
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProduct'
            examples:
              createProductExample:
                value:
                  api_name: "New API"
                  description: "A new API product"
      responses:
        '201':
          description: Product created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                productCreated:
                  value:
                    success: true
                    message: "Product created successfully"
                    data:
                      product:
                        id: "p3333333-3333-3333-3333-333333333333"
                        api_name: "New API"
                        description: "A new API product"
                        is_archived: false
                    errors: null
                    meta: null

  /products/{id}:
    get:
      tags: [products]
      summary: Get product
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      responses:
        '200':
          description: Product retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                productGet:
                  value:
                    success: true
                    message: "Product retrieved successfully"
                    data:
                      product:
                        id: "p1111111-1111-1111-1111-111111111111"
                        api_name: "Billing API"
                        description: "Endpoints for billing and invoicing"
                        is_archived: false
                    errors: null
                    meta: null
    put:
      tags: [products]
      summary: Update product (replace)
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProduct'
      responses:
        '200':
          description: Product updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                productUpdated:
                  value:
                    success: true
                    message: "Product updated successfully"
                    data:
                      product:
                        id: "p1111111-1111-1111-1111-111111111111"
                        api_name: "Billing API"
                        description: "Updated description"
                        is_archived: false
                    errors: null
                    meta: null
    patch:
      tags: [products]
      summary: Update product (partial)
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      requestBody:
        content:
          application/json:
            schema:
              type: object
            examples:
              productPatchExample:
                value:
                  description: "Updated description"
      responses:
        '200':
          description: Product partially updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                productPatched:
                  value:
                    success: true
                    message: "Product updated successfully"
                    data:
                      product:
                        id: "p1111111-1111-1111-1111-111111111111"
                        description: "Updated description"
                    errors: null
                    meta: null
    delete:
      tags: [products]
      summary: Archive product
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      responses:
        '200':
          description: Product archived
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                productArchived:
                  value:
                    success: true
                    message: "Product has been archived successfully"
                    data:
                      product:
                        id: "p1111111-1111-1111-1111-111111111111"
                        is_archived: true
                    errors: null
                    meta: null

  /contracts:
    get:
      tags: [contracts]
      summary: List contracts
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Contracts retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                contractsList:
                  value:
                    success: true
                    message: "Contracts retrieved successfully"
                    data:
                      contracts:
                        - id: "c1111111-1111-1111-1111-111111111111"
                          client_id: "aaaaaaa1-aaaa-aaaa-aaaa-aaaaaaaaaaa1"
                          contract_name: "Acme Annual"
                          start_date: "2026-01-01T00:00:00Z"
                          end_date: "2026-12-31T23:59:59Z"
                          is_archived: false
                    errors: null
                    meta: null
    post:
      tags: [contracts]
      summary: Create contract
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateContract'
      responses:
        '201':
          description: Contract created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                contractCreated:
                  value:
                    success: true
                    message: "Contract created successfully"
                    data:
                      contract:
                        id: "c2222222-2222-2222-2222-222222222222"
                        client_id: "aaaaaaa2-aaaa-aaaa-aaaa-aaaaaaaaaaa2"
                        contract_name: "NewCo 2026"
                        start_date: "2026-02-01T00:00:00Z"
                        end_date: "2027-01-31T23:59:59Z"
                        is_archived: false
                    errors: null
                    meta: null

  /contracts/{id}:
    get:
      tags: [contracts]
      summary: Get contract
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      responses:
        '200':
          description: Contract retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                contractGet:
                  value:
                    success: true
                    message: "Contract retrieved successfully"
                    data:
                      contract:
                        id: "c1111111-1111-1111-1111-111111111111"
                        client_id: "aaaaaaa1-aaaa-aaaa-aaaa-aaaaaaaaaaa1"
                        contract_name: "Acme Annual"
                        start_date: "2026-01-01T00:00:00Z"
                        end_date: "2026-12-31T23:59:59Z"
                        is_archived: false
                        subscriptions:
                          - id: "s1111111-1111-1111-1111-111111111111"
                            contract_id: "c1111111-1111-1111-1111-111111111111"
                            product_id: "p1111111-1111-1111-1111-111111111111"
                            pricing_type: "Variable"
                            strategy: "Fill"
                            is_archived: false
                            product:
                              id: "p1111111-1111-1111-1111-111111111111"
                              api_name: "Billing API"
                    errors: null
                    meta: null
    put:
      tags: [contracts]
      summary: Update contract (replace)
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateContract'
      responses:
        '200':
          description: Contract updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                contractUpdated:
                  value:
                    success: true
                    message: "Contract updated successfully"
                    data:
                      contract:
                        id: "c1111111-1111-1111-1111-111111111111"
                        contract_name: "Acme Annual (updated)"
                    errors: null
                    meta: null
    patch:
      tags: [contracts]
      summary: Update contract (partial)
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      requestBody:
        content:
          application/json:
            schema:
              type: object
            examples:
              contractPatchExample:
                value:
                  contract_name: "Acme Annual (Q2 update)"
      responses:
        '200':
          description: Contract partially updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                contractPatched:
                  value:
                    success: true
                    message: "Contract updated successfully"
                    data:
                      contract:
                        id: "c1111111-1111-1111-1111-111111111111"
                        contract_name: "Acme Annual (Q2 update)"
                    errors: null
                    meta: null
    delete:
      tags: [contracts]
      summary: Archive contract
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      responses:
        '200':
          description: Contract archived
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                contractArchived:
                  value:
                    success: true
                    message: "Contract archived successfully"
                    data:
                      contract:
                        id: "c1111111-1111-1111-1111-111111111111"
                        is_archived: true
                    errors: null
                    meta: null

  /contracts/{id}/product:
    get:
      tags: [contracts]
      summary: Get product for a contract
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      responses:
        '200':
          description: Product for contract
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                contractProduct:
                  value:
                    success: true
                    message: "Product retrieved successfully"
                    data:
                      product:
                        id: "p1111111-1111-1111-1111-111111111111"
                        api_name: "Billing API"
                    errors: null
                    meta: null

  /contracts/{id}/subscriptions:
    get:
      tags: [contracts]
      summary: Get subscriptions for a contract
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      responses:
        '200':
          description: Subscriptions retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                subscriptionsForContract:
                  value:
                    success: true
                    message: "Subscriptions retrieved successfully"
                    data:
                      subscriptions:
                        - id: "s1111111-1111-1111-1111-111111111111"
                          contract_id: "c1111111-1111-1111-1111-111111111111"
                    errors: null
                    meta: null
    post:
      tags: [contracts]
      summary: Create subscription under a contract
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSubscription'
      responses:
        '201':
          description: Subscription created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                subscriptionCreated:
                  value:
                    success: true
                    message: "Subscription created successfully"
                    data:
                      subscription:
                        id: "s2222222-2222-2222-2222-222222222222"
                        contract_id: "c1111111-1111-1111-1111-111111111111"
                        product_id: "p2222222-2222-2222-2222-222222222222"
                        pricing_type: "Fixed"
                        strategy: "Fixed"
                        is_archived: false
                    errors: null
                    meta: null

  /subscriptions:
    get:
      tags: [subscriptions]
      summary: List subscriptions
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Subscriptions retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                subscriptionsList:
                  value:
                    success: true
                    message: "Subscriptions fetched successfully"
                    data:
                      subscriptions:
                        - id: "s1111111-1111-1111-1111-111111111111"
                          contract_id: "c1111111-1111-1111-1111-111111111111"
                          product_id: "p1111111-1111-1111-1111-111111111111"
                          pricing_type: "Variable"
                          strategy: "Fill"
                          product:
                            id: "p1111111-1111-1111-1111-111111111111"
                            api_name: "Billing API"
                          tiers:
                            - id: "t11111111-1111-1111-1111-111111111111"
                              rate_card_id: "rc111111-1111-1111-1111-111111111111"
                              min_calls: 0
                              max_calls: 100
                              unit_price: 12.50
                              is_archived: false
                    errors: null
                    meta: null
    post:
      tags: [subscriptions]
      summary: Create subscription
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSubscription'
      responses:
        '201':
          description: Subscription created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                subscriptionCreated:
                  value:
                    success: true
                    message: "Subscription created successfully"
                    data:
                      subscription:
                        id: "s3333333-3333-3333-3333-333333333333"
                        contract_id: "c1111111-1111-1111-1111-111111111111"
                        product_id: "p3333333-3333-3333-3333-333333333333"
                        pricing_type: "Variable"
                        strategy: "Pick"
                        is_archived: false
                    errors: null
                    meta: null

  /subscriptions/{id}:
    get:
      tags: [subscriptions]
      summary: Get subscription
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      responses:
        '200':
          description: Subscription retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                subscriptionGet:
                  value:
                    success: true
                    message: "Subscription fetched successfully"
                    data:
                      subscription:
                        id: "s1111111-1111-1111-1111-111111111111"
                        contract_id: "c1111111-1111-1111-1111-111111111111"
                        product:
                          id: "p1111111-1111-1111-1111-111111111111"
                          api_name: "Billing API"
                        pricing_type: "Variable"
                        strategy: "Fill"
                        tiers:
                          - id: "t11111111-1111-1111-1111-111111111111"
                            rate_card_id: "rc111111-1111-1111-1111-111111111111"
                            min_calls: 0
                            max_calls: 100
                            unit_price: 12.50
                            is_archived: false
                    errors: null
                    meta: null
    put:
      tags: [subscriptions]
      summary: Update subscription (replace)
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSubscription'
      responses:
        '200':
          description: Subscription updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                subscriptionUpdated:
                  value:
                    success: true
                    message: "Subscription updated successfully"
                    data:
                      subscription:
                        id: "s1111111-1111-1111-1111-111111111111"
                        pricing_type: "Fixed"
                        strategy: "Fixed"
                    errors: null
                    meta: null
    patch:
      tags: [subscriptions]
      summary: Update subscription (partial)
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      requestBody:
        content:
          application/json:
            schema:
              type: object
            examples:
              subscriptionPatchExample:
                value:
                  strategy: "Pick"
      responses:
        '200':
          description: Subscription partially updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                subscriptionPatched:
                  value:
                    success: true
                    message: "Subscription updated successfully"
                    data:
                      subscription:
                        id: "s1111111-1111-1111-1111-111111111111"
                        strategy: "Pick"
                    errors: null
                    meta: null
    delete:
      tags: [subscriptions]
      summary: Archive subscription
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      responses:
        '200':
          description: Subscription archived
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                subscriptionArchived:
                  value:
                    success: true
                    message: "Subscription has been archived successfully"
                    data:
                      subscription:
                        id: "s1111111-1111-1111-1111-111111111111"
                        is_archived: true
                    errors: null
                    meta: null

  /subscriptions/{id}/tiers:
    get:
      tags: [subscriptions]
      summary: Get the subscription tiers for this subscription (active only)
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      responses:
        '200':
          description: Subscription tiers retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                subscriptionTiersForSubscription:
                  value:
                    success: true
                    message: "Subscription tiers fetched successfully"
                    data:
                      tiers:
                        - id: "t11111111-1111-1111-1111-111111111111"
                          rate_card_id: "rc111111-1111-1111-1111-111111111111"
                          min_calls: 0
                          max_calls: 100
                          unit_price: 12.50
                          is_archived: false
                    errors: null
                    meta: null

  /rate-cards:
    get:
      tags: [rate_cards]
      summary: List rate cards
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Rate cards retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                rateCardsList:
                  value:
                    success: true
                    message: "Rate cards retrieved successfully"
                    data:
                      rate_cards:
                        - id: "rc111111-1111-1111-1111-111111111111"
                          subscription_id: "s1111111-1111-1111-1111-111111111111"
                          start_date: "2026-01-01T00:00:00Z"
                          end_date: "2026-12-31T23:59:59Z"
                          tiers:
                            - id: "t11111111-1111-1111-1111-111111111111"
                              rate_card_id: "rc111111-1111-1111-1111-111111111111"
                              min_calls: 0
                              max_calls: 100
                              unit_price: 12.50
                              is_archived: false
                    errors: null
                    meta: null
    post:
      tags: [rate_cards]
      summary: Create a rate card (belongs to subscription)
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRateCard'
            examples:
              createRateCard:
                value:
                  subscription_id: "s1111111-1111-1111-1111-111111111111"
                  start_date: "2026-01-01T00:00:00Z"
                  end_date: "2026-12-31T23:59:59Z"
      responses:
        '201':
          description: Rate card created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                rateCardCreated:
                  value:
                    success: true
                    message: "Rate card created successfully"
                    data:
                      rate_card:
                        id: "rc222222-2222-2222-2222-222222222222"
                        subscription_id: "s1111111-1111-1111-1111-111111111111"
                        start_date: "2026-02-01T00:00:00Z"
                        end_date: "2026-08-31T23:59:59Z"
                        tiers: []
                    errors: null
                    meta: null

  /rate-cards/{id}:
    get:
      tags: [rate_cards]
      summary: Get rate card
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      responses:
        '200':
          description: Rate card retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                rateCardGet:
                  value:
                    success: true
                    message: "Rate card retrieved successfully"
                    data:
                      rate_card:
                        id: "rc111111-1111-1111-1111-111111111111"
                        subscription_id: "s1111111-1111-1111-1111-111111111111"
                        start_date: "2026-01-01T00:00:00Z"
                        end_date: "2026-12-31T23:59:59Z"
                        tiers:
                          - id: "t11111111-1111-1111-1111-111111111111"
                            rate_card_id: "rc111111-1111-1111-1111-111111111111"
                            min_calls: 0
                            max_calls: 100
                            unit_price: 12.50
                            is_archived: false
                    errors: null
                    meta: null
    put:
      tags: [rate_cards]
      summary: Update rate card (replace)
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRateCard'
      responses:
        '200':
          description: Rate card updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                rateCardUpdated:
                  value:
                    success: true
                    message: "Rate card updated successfully"
                    data:
                      rate_card:
                        id: "rc111111-1111-1111-1111-111111111111"
                        start_date: "2026-01-01T00:00:00Z"
                        end_date: "2026-12-31T23:59:59Z"
                    errors: null
                    meta: null
    patch:
      tags: [rate_cards]
      summary: Update rate card (partial)
      security: [{ bearerAuth: [] }]
      parameters: [ { $ref: '#/components/parameters/idParam' } ]
      requestBody:
        content:
          application/json:
            schema:
              type: object
            examples:
              rateCardPatchExample:
                value:
                  end_date: "2026-10-31T23:59:59Z"
      responses:
        '200':
          description: Rate card partially updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                rateCardPatched:
                  value:
                    success: true
                    message: "Rate card updated successfully"
                    data:
                      rate_card:
                        id: "rc111111-1111-1111-1111-111111111111"
                        end_date: "2026-10-31T23:59:59Z"
                    errors: null
                    meta: null
    delete:
      tags: [rate_cards]
      summary: Archive rate card (soft-delete) and cascade to child tiers
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      responses:
        '200':
          description: Rate card archived
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                rateCardArchived:
                  value:
                    success: true
                    message: "Rate card archived successfully"
                    data:
                      rate_card:
                        id: "rc111111-1111-1111-1111-111111111111"
                        is_archived: true
                    errors: null
                    meta: null

  /rate-cards/{id}/subscription-tiers:
    get:
      tags: [rate_cards]
      summary: Get subscription tiers for a rate card
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      responses:
        '200':
          description: Subscription tiers for rate card
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                tiersForRateCard:
                  value:
                    success: true
                    message: "Subscription tiers for rate card retrieved successfully"
                    data:
                      subscription_tiers:
                        - id: "t11111111-1111-1111-1111-111111111111"
                          rate_card_id: "rc111111-1111-1111-1111-111111111111"
                          min_calls: 0
                          max_calls: 100
                          unit_price: 12.50
                          is_archived: false
                    errors: null
                    meta: null

  /subscription-tiers:
    get:
      tags: [subscription_tiers]
      summary: List subscription tiers
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Subscription tiers retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                tiersList:
                  value:
                    success: true
                    message: "Subscription tiers retrieved successfully"
                    data:
                      subscription_tiers:
                        - id: "t11111111-1111-1111-1111-111111111111"
                          rate_card_id: "rc111111-1111-1111-1111-111111111111"
                          min_calls: 0
                          max_calls: 100
                          unit_price: 12.50
                          is_archived: false
                    errors: null
                    meta: null
    post:
      tags: [subscription_tiers]
      summary: Create subscription tier under a rate card
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSubscriptionTier'
            examples:
              createTierExample:
                value:
                  rate_card_id: "rc111111-1111-1111-1111-111111111111"
                  min_calls: 0
                  max_calls: 100
                  unit_price: 12.50
      responses:
        '201':
          description: Subscription tier created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                tierCreated:
                  value:
                    success: true
                    message: "Subscription tier created successfully"
                    data:
                      subscription_tier:
                        id: "t22222222-2222-2222-2222-222222222222"
                        rate_card_id: "rc111111-1111-1111-1111-111111111111"
                        min_calls: 0
                        max_calls: 100
                        unit_price: 15.00
                        is_archived: false
                    errors: null
                    meta: null

  /subscription-tiers/{id}:
    get:
      tags: [subscription_tiers]
      summary: Get subscription tier
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      responses:
        '200':
          description: Subscription tier retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                tierGet:
                  value:
                    success: true
                    message: "Subscription tier retrieved successfully"
                    data:
                      subscription_tier:
                        id: "t11111111-1111-1111-1111-111111111111"
                        rate_card_id: "rc111111-1111-1111-1111-111111111111"
                        min_calls: 0
                        max_calls: 100
                        unit_price: 12.50
                        is_archived: false
                    errors: null
                    meta: null
    put:
      tags: [subscription_tiers]
      summary: Update subscription tier (replace)
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSubscriptionTier'
      responses:
        '200':
          description: Subscription tier updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                tierUpdated:
                  value:
                    success: true
                    message: "Subscription tier updated successfully"
                    data:
                      subscription_tier:
                        id: "t11111111-1111-1111-1111-111111111111"
                        min_calls: 10
                        max_calls: 200
                        unit_price: 10.00
                        is_archived: false
                    errors: null
                    meta: null
    patch:
      tags: [subscription_tiers]
      summary: Update subscription tier (partial)
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      requestBody:
        content:
          application/json:
            schema:
              type: object
            examples:
              tierPatchExample:
                value:
                  unit_price: 11.00
      responses:
        '200':
          description: Subscription tier partially updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                tierPatched:
                  value:
                    success: true
                    message: "Subscription tier updated successfully"
                    data:
                      subscription_tier:
                        id: "t11111111-1111-1111-1111-111111111111"
                        unit_price: 11.00
                    errors: null
                    meta: null
    delete:
      tags: [subscription_tiers]
      summary: Archive subscription tier (soft-delete)
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      responses:
        '200':
          description: Subscription tier archived
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                tierArchived:
                  value:
                    success: true
                    message: "Subscription tier archived successfully"
                    data:
                      subscription_tier:
                        id: "t11111111-1111-1111-1111-111111111111"
                        is_archived: true
                    errors: null
                    meta: null

  /subscription-tiers/{id}/subscriptions:
    get:
      tags: [subscription_tiers]
      summary: Get the subscription for a tier
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: '#/components/parameters/idParam'
      responses:
        '200':
          description: Subscription for tier retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Envelope'
              examples:
                tierSubscription:
                  value:
                    success: true
                    message: "Subscription retrieved successfully"
                    data:
                      subscription:
                        id: "s1111111-1111-1111-1111-111111111111"
                        contract_id: "c1111111-1111-1111-1111-111111111111"
                        product:
                          id: "p1111111-1111-1111-1111-111111111111"
                          api_name: "Billing API"
                        pricing_type: "Variable"
                        strategy: "Fill"
                    errors: null
                    meta: null

security:
  - bearerAuth: []